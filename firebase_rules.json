{
  "rules": {
    // We want this field only to be readable by the server when accessed using
    // https://www.firebase.com/docs/web/guide/login/custom.html#section-rest-server-authentication
    "apiKey": {
      ".read": false,
      ".write": false
    },

    "githubActivity": {
      "$autoGeneratedId": {
        ".read": false,
        ".write": true,
        // Only write new GitHub activity if we have at least on active subscription for that repo.
        ".validate": "root.child('repoToSubscriptionIds').hasChild('' + newData.child('repository/id').val())"
      }
    },

    "repoToSubscriptionIds": {
      "$repoId": {
        "$subscriptionId": {
          ".read": "data.val() === auth.uid",
          ".write": "newData.exists() ? newData.val() === auth.uid : data.val() === auth.uid"
        }
      }
    }
  }
}
