<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="A GitHub notifier, built using Firebase and service worker notifications.">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1">

    <title>GH Notifier</title>

    <link rel="manifest" href="manifest.json">
    <link rel="icon" sizes="192x192" href="images/icon.png">

    <link rel="stylesheet" href="styles/main.css">

    <script src="bower_components/webcomponentsjs/webcomponents.min.js"></script>
    <link rel="import" href="elements.html">
  </head>

  <body fullbleed>
    <template id="page-template" is="auto-binding">
      <core-animated-pages valueattr="id"
                           transitions="cross-fade"
                           selected="{{selectedPage}}"
                           on-core-select="{{scrollToTop}}">
        <section id="log-in">
          <div layout horizontal center-center cross-fade>
            <paper-button raised on-click="{{login}}">
              <core-icon src="images/GitHub-Mark-32px.png"></core-icon>
              <span>Login with GitHub</span>
            </paper-button>
          </div>
        </section>

        <section id="choose-repo">
          <div layout vertical cross-fade>
            <ul id="repo-list" flex>
              <template repeat="{{gitHubRepo in gitHubRepos}}">
                <li layout horizontal center>
                  <span flex>{{gitHubRepo.full_name}}</span>
                  <paper-toggle-button class="notification"
                                       id="{{gitHubRepo.id}}"
                                       checked?="{{gitHubRepo.activeSubscription}}"
                                       on-change="{{toggleSubscriptionToRepo}}">
                  </paper-toggle-button>
                  <paper-button raised on-click="{{showEditRepo}}">
                    <span>Triggers</span>
                  </paper-button>
                </li>
              </template>
            </ul>
            <paper-button raised on-click="{{logout}}" self-start>
              <core-icon src="images/GitHub-Mark-32px.png"></core-icon>
              <span>Logout</span>
            </paper-button>
          </div>
        </section>

        <section id="edit-repo">
          <div layout vertical cross-fade>
            <header>Triggers for <span>{{selectedRepo.full_name}}</span></header>
            <ul id="web-hook-list" flex>
              <template repeat="{{event in allWebhookEvents}}">
                <li layout horizontal center>
                  <span flex>{{event}}</span>
                  <paper-toggle-button class="event"
                                       id="{{event}}"
                                       disabled>
                  </paper-toggle-button>
                </li>
              </template>
            </ul>
            <div layout horizontal>
              <paper-button raised on-click="{{showChooseRepo}}" self-start>
                <span>Cancel</span>
              </paper-button>
              <paper-button raised on-click="{{saveWebhook}}" self-start>
                <span>Save</span>
              </paper-button>
            </div>
          </div>
        </section>
      </core-animated-pages>

      <paper-toast></paper-toast>

      <template if="{{loggedIn && subscriptionId}}">
        <core-ajax auto
                   url="https://api.github.com/user/repos"
                   handleAs="json"
                   headers='{"Authorization": "token {{authData.github.accessToken}}"}'
                   on-core-response="{{processGitHubRepos}}">
        </core-ajax>
      </template>

      <template if="{{loggedIn && selectedRepo}}">
        <core-ajax auto
                   url="{{selectedRepo.hooks_url}}"
                   handleAs="json"
                   headers='{"Authorization": "token {{authData.github.accessToken}}"}'
                   on-core-response="{{processHooks}}">
        </core-ajax>
      </template>
    </template>

    <script src="bundled_scripts/bundle.js"></script>
  </body>
</html>
